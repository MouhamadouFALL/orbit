<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <record id="view_account_tracker_filter" model="ir.ui.view">
            <field name="name">account.tracker.select</field>
            <field name="model">account.tracker.line</field>
            <field name="arch" type="xml">
                <search string="Search Follow-up">
                    <field name="sale_order_id" />
                    <field name="name" />
                    <field name="client" />
                    <field name="due_date" />
                    <filter name="due_date" string="Echeance" date="due_date"/>
                    <!-- <group expqnd="0" string="Group By">
                        <filter string="Date Echeance" name="mdate" context="{'group_by': 'due_date'}"/>
                    </group> -->
                </search>
            </field>
        </record>

        <record id="action_account_tracker_line_form" model="ir.actions.act_window">
            <field name="name">Relances de paiement</field>
            <field name="res_model">account.tracker.line</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_account_tracker_filter"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to define follow-up levels and their related actions.
                </p>
                <p>
                    For each step, specify the actions to be taken and delay in days. It is
                    possible to use print and e-mail templates to send specific messages to
                    the customer.
                </p>
            </field>
        </record>

        <record id="view_account_tracker_line_form" model="ir.ui.view">
            <field name="name">account.tracker.line.form</field>
            <field name="model">account.tracker.line</field>
            <field name="arch" type="xml">
                <form string="Follow-up Action">
                    <header>
                        <button name="send_email_relance" type="object" string="Envoyer Email" attrs="{'invisible': [('send_email', '=', False)]}"/>
                        <button name="send_letter_relance" type="object" string="Envoyer Lettre" attrs="{'invisible': [('send_letter', '=', False)]}"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1><field class="text-break" name="name" placeholder="Entrer le nom de Relance" /></h1>
                            <h2 class="d-flex gap-2 g-0 align-items-end pb-3" >
                                <div>
                                    <!-- <label for="tracker_id" class="oe_edit_only pb-1" />
                                    <div>
                                        <field name="tracker_id" class="oe_inline o_input_8ch" widget="Many2one_tags" options="{'no_create': True, 'no_open': True}" />
                                    </div> -->
                                    <label for="delay" class="oe_edit_only pb-1"/>
                                     <div class="oe_inline">
                                         <span class="oe_grey"> After </span> <field name="delay" class="oe_inline"/> <span class="oe_grey"> days overdue, do the following actions:</span>
                                    </div>
                                </div>
                            </h2>
                        </div>
                        <group>
                            <group name="group_name">
                                <field name="is_responsible" invisible="1"/>
                                <field name="client" widget="many2one_tags"/>
                                <!-- <field name="user_id"/> -->
                                <field name="nb_relance" attrs="{'readonly': [('is_responsible', '==', False)]}"/>
                            </group>
                            <group name="group_term_pso">
                                <field name="sale_order_id" widget="select" options="{'no_create': True, 'no_open': True}"/>
                                <field name="due_date" widget="remaining_days"/>
                                <field name="shipping_date"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="amount_to_paid"/>
                                <field name="amount_paid"/>
                                <field name="amount_remaining"/>
                            </group>
                            <group>
                                <field name="manual_action"/>
                                <field name="send_email" attrs="{'invisible': [('manual_action', '=', False)]}"/>
                                <field name="send_letter" attrs="{'readonly': True, 'invisible': [('manual_action', '=', False)]}"/>
                            </group>
                        </group>
                        <group name="payment_plan" string="Montants et Dates de paiements prevues">
                            <group>
                                <field name="first_payment_date" string="Date Echeance 1" readonly="1"/>
                                <field name="second_payment_date" string="Date Echeance 2" readonly="1"/>
                                <field name="third_payment_date" string="Date Echeance 3" readonly="1"/>
                            </group>
                            <group>
                                <field name="amount_date1" string="montant à verser" readonly="1"/>
                                <field name="amount_date2" string="montant à verser" readonly="1"/>
                                <field name="amount_date3" string="montant à verser" readonly="1"/>
                            </group>
                            <group>
                                <field name="status" string="Statut" readonly="1"/>
                                <field name="status" string="Statut" readonly="1"/>
                                <field name="status" string="Statut" readonly="1"/>
                            </group>
                        </group>
                        <group string="Action to do" attrs="{'invisible': [('send_email', '=', False), ('send_letter', '=', False)]}">
                            <group>
                                <field name="manual_action_responsible_id" widget="many2one_tags"/>
                            </group>
                            <group>
                                <field name="manual_action_note" attrs="{'required': [('manual_action', '&lt;&gt;', False)]}"
                                   placeholder="e.g. Call the customer, check if it's paid, ..."/>
                            </group>
                            <group string="Send E-mail" attrs="{'invisible': [('send_email', '=', False)]}" colspan="2">
                                <field name="email_template_id" widget="select" attrs="{'required': [('send_email', '&lt;&gt;', False)]}"/>
                            </group>
                            <group string="Send Letter" attrs="{'invisible': [('send_letter', '=', False)]}" colspan="2">
                                <p colspan="2" class="oe_grey">
                                Write here the introduction in the letter,
                                according to the level of the follow-up. You can
                                use the following keywords in the text. Don't
                                forget to translate in all languages you installed
                                using to top right icon.
                                </p>
                                <field name="description" nolabel="1" colspan="2"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_account_tracker_line_tree" model="ir.ui.view">
            <field name="name">account.tracker.line.tree</field>
            <field name="model">account.tracker.line</field>
            <field name="arch" type="xml">
                <tree string="Follow-up Action" >
                    <field name="client" widget="many2one_tags"/>
                    <field name="name"/>
                    <field name="sale_order_id" widget="many2one_tags"/>
                    <field name="amount_paid"/>
                    <field name="amount_remaining"/>
                    <field name="nb_relance"/>
                    <field name="due_date" widget="remaining_days" string="Echance 2"/>
                    <field name="amount_to_paid" optional="hide"/>
                    <field name="manual_action_responsible_id" optional="hide"/>
                    <field name="shipping_date" optional="hide"/>
                </tree>
            </field>
        </record>

    </data>
</odoo>